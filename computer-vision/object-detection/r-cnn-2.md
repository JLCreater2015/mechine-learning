# R-CNNåŸç†ï¼ˆäºŒï¼‰

## ğŸ–Œ 3ã€Fast R-CNN

Fast R-CNNæ˜¯ç«¯åˆ°ç«¯ï¼ˆend-to-endï¼‰çš„ã€‚

![](../../.gitbook/assets/image%20%2810%29.png)

å›¾ä¸­çœç•¥äº†é€šè¿‡ `ss` è·å¾—proposalçš„è¿‡ç¨‹ï¼Œç¬¬ä¸€å¼ å›¾ä¸­çº¢æ¡†é‡Œçš„å†…å®¹å³ä¸ºé€šè¿‡`ss`æå–åˆ°çš„proposalï¼Œä¸­é—´çš„ä¸€å—æ˜¯ç»è¿‡æ·±åº¦å·ç§¯ä¹‹åå¾—åˆ°çš„conv feature mapï¼Œå›¾ä¸­ç°è‰²çš„éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬çº¢æ¡†ä¸­çš„proposalå¯¹åº”äº`conv feature map`ä¸­çš„ä½ç½®ï¼Œä¹‹åå¯¹è¿™ä¸ªç‰¹å¾ç»è¿‡`ROI pooling layer`å¤„ç†ï¼Œä¹‹åè¿›è¡Œå…¨è¿æ¥ã€‚åœ¨è¿™é‡Œå¾—åˆ°çš„ROI feature vectoræœ€ç»ˆè¢«åˆ†äº«ï¼Œä¸€ä¸ªè¿›è¡Œå…¨è¿æ¥ä¹‹åç”¨æ¥åš`softmax`å›å½’ï¼Œç”¨æ¥è¿›è¡Œåˆ†ç±»ï¼Œå¦ä¸€ä¸ªç»è¿‡å…¨è¿æ¥ä¹‹åç”¨æ¥åš`bbox`å›å½’ã€‚

> å¯¹ä¸­é—´çš„`Conv feature map`è¿›è¡Œç‰¹å¾æå–ã€‚æ¯ä¸€ä¸ªåŒºåŸŸç»è¿‡`RoI pooling layer`å’Œ`FC layers`å¾—åˆ°ä¸€ä¸ª â€œå›ºå®šé•¿åº¦â€ çš„feature vectorï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥åˆ°åé¢`RoI pooling layer`çš„feature mapæ˜¯åœ¨`Conv feature map`ä¸Šæå–çš„ï¼Œæ•…æ•´ä¸ªç‰¹å¾æå–è¿‡ç¨‹ï¼Œåªè®¡ç®—äº†ä¸€æ¬¡å·ç§¯ã€‚è™½ç„¶åœ¨æœ€å¼€å§‹ä¹Ÿæå–å‡ºäº†å¤§é‡çš„`RoI`ï¼Œä½†ä»–ä»¬è¿˜æ˜¯ä½œä¸ºæ•´ä½“è¾“å…¥è¿›å·ç§¯ç½‘ç»œçš„ï¼Œæœ€å¼€å§‹æå–å‡ºçš„`RoI`åŒºåŸŸåªæ˜¯ä¸ºäº†æœ€åçš„Bounding box å›å½’æ—¶ä½¿ç”¨ï¼Œç”¨æ¥è¾“å‡ºåŸå›¾ä¸­çš„ä½ç½®ï¼‰ã€‚

### ğŸ–‹ 3.1ã€ç‰¹ç‚¹

1. è§„é¿R-CNNä¸­å†—ä½™çš„ç‰¹å¾æå–æ“ä½œï¼Œåªå¯¹æ•´å¼ å›¾åƒå…¨åŒºåŸŸè¿›è¡Œä¸€æ¬¡ç‰¹å¾æå–ï¼ˆ`SPP Net`ï¼‰ï¼›
2. ç”¨`RoI pooling`å±‚å–ä»£æœ€åä¸€å±‚max poolingå±‚ï¼ŒåŒæ—¶å¼•å…¥å»ºè®®æ¡†ä¿¡æ¯ï¼Œæå–ç›¸åº”å»ºè®®æ¡†ç‰¹å¾ï¼›
3. Fast R-CNNç½‘ç»œæœ«å°¾é‡‡ç”¨å¹¶è¡Œçš„ä¸åŒçš„å…¨è¿æ¥å±‚ï¼Œå¯åŒæ—¶è¾“å‡ºåˆ†ç±»ç»“æœå’Œçª—å£å›å½’ç»“æœï¼Œå®ç°äº†end-to-endçš„å¤šä»»åŠ¡è®­ç»ƒã€å»ºè®®æ¡†æå–é™¤å¤–ã€‘ï¼Œä¹Ÿä¸éœ€è¦é¢å¤–çš„ç‰¹å¾å­˜å‚¨ç©ºé—´ã€R-CNNä¸­è¿™éƒ¨åˆ†ç‰¹å¾æ˜¯ä¾›`SVM`å’ŒBounding-box regressionè¿›è¡Œè®­ç»ƒçš„ã€‘ï¼›
4. é‡‡ç”¨`SVD`å¯¹Fast R-CNNç½‘ç»œæœ«å°¾å¹¶è¡Œçš„å…¨è¿æ¥å±‚è¿›è¡Œåˆ†è§£ï¼Œå‡å°‘è®¡ç®—å¤æ‚åº¦ï¼ŒåŠ å¿«æ£€æµ‹é€Ÿåº¦ã€‚

Fast R-CNNæ–¹æ³•è§£å†³äº†R-CNNçš„ä¸‰ä¸ªé—®é¢˜ï¼š

1. R-CNNç½‘ç»œè®­ç»ƒã€æµ‹è¯•é€Ÿåº¦éƒ½å¾ˆæ…¢ï¼šR-CNNç½‘ç»œä¸­ï¼Œä¸€å¼ å›¾ç»ç”±selective searchç®—æ³•æå–çº¦2kä¸ªå»ºè®®æ¡†ã€è¿™2kä¸ªå»ºè®®æ¡†å¤§é‡é‡å ã€‘ï¼Œè€Œæ‰€æœ‰å»ºè®®æ¡†å˜å½¢åéƒ½è¦è¾“å…¥`AlexNet` CNNç½‘ç»œæå–ç‰¹å¾ã€å³çº¦2kæ¬¡ç‰¹å¾æå–ã€‘ï¼Œä¼šå‡ºç°ä¸Šè¿°é‡å åŒºåŸŸå¤šæ¬¡é‡å¤æå–ç‰¹å¾ï¼Œæå–ç‰¹å¾æ“ä½œå†—ä½™ï¼›
2. R-CNNç½‘ç»œè®­ç»ƒã€æµ‹è¯•ç¹çï¼šR-CNNç½‘ç»œè®­ç»ƒè¿‡ç¨‹åˆ†ä¸ºILSVRC 2012æ ·æœ¬ä¸‹æœ‰ç›‘ç£é¢„è®­ç»ƒã€`PASCAL VOC 2007`è¯¥ç‰¹å®šæ ·æœ¬ä¸‹çš„å¾®è°ƒã€20ç±»å³21ä¸ª`SVM`åˆ†ç±»å™¨è®­ç»ƒå’Œ20ä¸ªBounding-boxå›å½’å™¨è®­ç»ƒï¼Œè¯¥è®­ç»ƒæµç¨‹ç¹çå¤æ‚ï¼Œå¹¶ä¸”éœ€è¦å¤§é‡å­˜å‚¨ç©ºé—´ï¼›
3. R-CNNç½‘ç»œéœ€è¦å¯¹å»ºè®®æ¡†è¿›è¡Œå½¢å˜æ“ä½œåã€å½¢å˜ä¸º227Ã—227 sizeã€‘å†è¾“å…¥CNNç½‘ç»œæå–ç‰¹å¾ï¼Œå…¶å®åƒ`AlexNet`ç­‰ç½‘ç»œåœ¨æå–ç‰¹å¾è¿‡ç¨‹ä¸­å¯¹å›¾åƒçš„å¤§å°å¹¶æ— è¦æ±‚ï¼Œåªæ˜¯åœ¨æå–å®Œç‰¹å¾è¿›è¡Œå…¨è¿æ¥æ“ä½œçš„æ—¶å€™æ‰éœ€è¦å›ºå®šç‰¹å¾å°ºå¯¸ã€R-CNNä¸­å°†è¾“å…¥å›¾åƒå½¢å˜ä¸º227Ã—227å¯æ­£å¥½æ»¡è¶³`AlexNet`ç½‘ç»œæœ€åçš„ç‰¹å¾å°ºå¯¸è¦æ±‚ã€‘ï¼Œç„¶åæ‰ä½¿ç”¨`SVM`åˆ†ç±»å™¨åˆ†ç±»ï¼ŒR-CNNéœ€è¦è¿›è¡Œå½¢å˜æ“ä½œçš„é—®é¢˜åœ¨Fast R-CNNå·²ç»ä¸å­˜åœ¨ã€‚

### ğŸ–‹ 3.2ã€ç½‘ç»œç»“æ„

#### âœ 3.2.1ã€åŸºæœ¬ç½‘ç»œ

å›¾åƒå½’ä¸€åŒ–ä¸º 224Ã—224 åç›´æ¥é€å…¥ç½‘ç»œã€‚å‰äº”é˜¶æ®µæ˜¯åŸºç¡€çš„`conv+relu+pooling`å½¢å¼ï¼Œåœ¨ç¬¬äº”é˜¶æ®µç»“å°¾ï¼Œè¾“å…¥Pä¸ªå€™é€‰åŒºåŸŸï¼ˆå›¾åƒåºå·Ã—1 + å‡ ä½•ä½ç½®Ã—4ï¼Œåºå·ç”¨äºè®­ç»ƒï¼‰ã€‚

![](../../.gitbook/assets/image%20%2818%29.png)

> æ³¨ï¼šæ–‡ä¸­ç»™å‡ºäº†å¤§ä¸­å°ä¸‰ç§ç½‘ç»œï¼Œæ­¤å¤„æ˜¾ç¤ºå‡ºæœ€å¤§çš„ä¸€ç§ã€‚ä¸‰ç§ç½‘ç»œåŸºæœ¬ç»“æ„ç›¸ä¼¼ï¼Œä»…`conv+relu`å±‚æ•°æœ‰å·®åˆ«ï¼Œæˆ–è€…å¢åˆ äº†normå±‚ã€‚

#### âœ 3.2.2ã€`RoI pooling layer`

æ¯ä¸€ä¸ª`RoI`éƒ½æœ‰ä¸€ä¸ªå››å…ƒç»„ $$(r,c,h,w)$$ è¡¨ç¤ºï¼Œå…¶ä¸­ $$(r,c)$$ è¡¨ç¤ºå·¦ä¸Šè§’ï¼Œè€Œ $$(h,w)$$ åˆ™ä»£è¡¨é«˜åº¦å’Œå®½åº¦ã€‚è¿™ä¸€å±‚ä½¿ç”¨æœ€å¤§æ± åŒ–ï¼ˆmax poolingï¼‰æ¥å°†`RoI`åŒºåŸŸè½¬åŒ–æˆå›ºå®šå¤§å°çš„ $$H\times W$$ çš„ç‰¹å¾å›¾ã€‚å‡è®¾ä¸€ä¸ª`RoI`çš„çª—å£å¤§å°ä¸º $$h\times w$$ ï¼Œåˆ™è½¬æ¢æˆ $$H\times W$$ ä¹‹åï¼Œæ¯ä¸€ä¸ªç½‘æ ¼éƒ½æ˜¯ä¸€ä¸ª $$h/H * w/W$$ å¤§å°çš„å­ç½‘ï¼Œåˆ©ç”¨æœ€å¤§æ± åŒ–å°†è¿™ä¸ªå­ç½‘ä¸­çš„å€¼æ˜ å°„åˆ° $$H\times W$$ çª—å£å³å¯ã€‚Poolingå¯¹æ¯ä¸€ä¸ªç‰¹å¾å›¾é€šé“éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™æ˜¯`SPP layer`çš„ç‰¹ä¾‹ï¼Œå³åªæœ‰ä¸€å±‚çš„ç©ºé—´é‡‘å­—å¡”ã€‚

#### âœ 3.2.3ã€**åˆ†ç±»å™¨ä¸å›å½’å™¨**

åˆ†ç±»å™¨å’Œå›å½’å™¨çš„è¾“å…¥ä¸º`RoI`æ± åŒ–è¾“å‡ºçš„å›ºå®šå¤§å°å‘é‡ç»è¿‡ä¸¤å±‚å…¨è¿æ¥å±‚åäº§ç”Ÿçš„ç‰¹å¾å‘é‡ï¼Œåˆ†ç±»å™¨ç”¨äºåˆ¤æ–­ç‰©å“å±äºå“ªä¸€ç±»ï¼ˆç±»åˆ«+èƒŒæ™¯ï¼‰ï¼Œå›å½’å™¨ç”¨äºè®¡ç®—4ä¸ªè°ƒæ•´å› å­ï¼Œè°ƒæ•´å› å­éƒ¨åˆ†å†…å®¹è§R-CNNç¬”è®°ã€‚

### ğŸ–‹ 3.3ã€æµ‹è¯•è¿‡ç¨‹

![](../../.gitbook/assets/image%20%2815%29.png)

1. ä»»æ„sizeå›¾ç‰‡è¾“å…¥CNNç½‘ç»œï¼Œç»è¿‡è‹¥å¹²å·ç§¯å±‚ä¸æ± åŒ–å±‚ï¼Œå¾—åˆ°ç‰¹å¾å›¾ï¼›
2. åœ¨ä»»æ„sizeå›¾ç‰‡ä¸Šé‡‡ç”¨selective searchç®—æ³•æå–çº¦`2k`ä¸ªå»ºè®®æ¡†ï¼›
3. æ ¹æ®åŸå›¾ä¸­å»ºè®®æ¡†åˆ°ç‰¹å¾å›¾æ˜ å°„å…³ç³»ï¼Œåœ¨ç‰¹å¾å›¾ä¸­æ‰¾åˆ°æ¯ä¸ªå»ºè®®æ¡†å¯¹åº”çš„ç‰¹å¾æ¡†ã€æ·±åº¦å’Œç‰¹å¾å›¾ä¸€è‡´ã€‘ï¼Œå¹¶åœ¨`RoI`æ± åŒ–å±‚ä¸­å°†æ¯ä¸ªç‰¹å¾æ¡†æ± åŒ–åˆ° $$H\times W$$ ã€`VGG-16`ç½‘ç»œæ˜¯7Ã—7ã€‘çš„sizeï¼›
4. å›ºå®š $$H\times W$$ã€`VGG-16`ç½‘ç»œæ˜¯7Ã—7ã€‘å¤§å°çš„ç‰¹å¾æ¡†ç»è¿‡å…¨è¿æ¥å±‚å¾—åˆ°å›ºå®šå¤§å°çš„ç‰¹å¾å‘é‡ï¼›
5. ç¬¬4æ­¥æ‰€å¾—ç‰¹å¾å‘é‡ç»ç”±å„è‡ªçš„å…¨è¿æ¥å±‚ã€ç”±`SVD`åˆ†è§£å®ç°ã€‘ï¼Œåˆ†åˆ«å¾—åˆ°ä¸¤ä¸ªè¾“å‡ºå‘é‡ï¼šä¸€ä¸ªæ˜¯`softmax`çš„åˆ†ç±»å¾—åˆ†ï¼Œä¸€ä¸ªæ˜¯Bounding-boxçª—å£å›å½’ï¼›
6. åˆ©ç”¨çª—å£å¾—åˆ†åˆ†åˆ«å¯¹æ¯ä¸€ç±»ç‰©ä½“è¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶å‰”é™¤é‡å å»ºè®®æ¡†ï¼Œæœ€ç»ˆå¾—åˆ°æ¯ä¸ªç±»åˆ«ä¸­å›å½’ä¿®æ­£åçš„å¾—åˆ†æœ€é«˜çš„çª—å£ã€‚

#### âœ **3.2.1ã€å…¨è¿æ¥å±‚æé€Ÿ**

**ä¸ºä»€ä¹ˆè¦é‡‡ç”¨`SVD`åˆ†è§£å®ç°Fast R-CNNç½‘ç»œä¸­æœ€åçš„å…¨è¿æ¥å±‚ï¼Ÿå…·ä½“å¦‚ä½•å®ç°ï¼Ÿ**

å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œç”¨äºå·ç§¯å±‚è®¡ç®—çš„æ—¶é—´æ¯”ç”¨äºå…¨è¿æ¥å±‚è®¡ç®—çš„æ—¶é—´å¤šï¼Œè€Œåœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­ï¼Œselective searchç®—æ³•æå–çš„å»ºè®®æ¡†æ¯”è¾ƒå¤šï¼Œå‡ ä¹æœ‰ä¸€åŠçš„å‰å‘è®¡ç®—æ—¶é—´è¢«èŠ±è´¹äºå…¨è¿æ¥å±‚ï¼Œå°±Fast R-CNNè€Œè¨€ï¼Œ`RoI`æ± åŒ–å±‚åçš„å…¨è¿æ¥å±‚éœ€è¦è¿›è¡Œçº¦ `2k` æ¬¡ã€æ¯ä¸ªå»ºè®®æ¡†éƒ½è¦è®¡ç®—ã€‘ï¼Œå› æ­¤åœ¨Fast R-CNNä¸­å¯ä»¥é‡‡ç”¨`SVD`åˆ†è§£åŠ é€Ÿå…¨è¿æ¥å±‚è®¡ç®—ï¼›

åˆ†ç±»å’Œä½ç½®è°ƒæ•´éƒ½æ˜¯é€šè¿‡å…¨è¿æ¥å±‚å®ç°çš„ï¼Œè®¾å‰ä¸€çº§æ•°æ®ä¸º x åä¸€çº§ä¸º yï¼Œå…¨è¿æ¥å±‚å‚æ•°ä¸ºWï¼Œå°ºå¯¸ $$u\times v$$ ã€‚ä¸€æ¬¡å‰å‘ä¼ æ’­ï¼ˆforwardï¼‰å³ä¸º $$y=Wx$$ ï¼Œè®¡ç®—å¤æ‚åº¦ä¸º$$u\times v$$ ã€‚ å°†Wè¿›è¡Œ`SVD`åˆ†è§£ï¼Œå¹¶ç”¨å‰ $$t$$ ä¸ªç‰¹å¾å€¼è¿‘ä¼¼ï¼š

$$
W=U\sum V^T \approx U(:,1:t)â‹…\sum (1:t,1:t)â‹…V(:,1:t)^T
$$

åŸæ¥çš„å‰å‘ä¼ æ’­åˆ†è§£æˆä¸¤æ­¥ï¼š

$$
y=Wx=Uâ‹…(\sum â‹…V^T)â‹…x=Uâ‹…z
$$

è®¡ç®—å¤æ‚åº¦å˜ä¸º $$uÃ—t+vÃ—t$$ ã€‚ åœ¨å®ç°æ—¶ï¼Œç›¸å½“äºæŠŠä¸€ä¸ªå…¨è¿æ¥å±‚æ‹†åˆ†æˆä¸¤ä¸ªï¼Œä¸­é—´ä»¥ä¸€ä¸ªä½ç»´æ•°æ®ç›¸è¿ã€‚ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚ä¸å«åç½®ï¼Œç¬¬äºŒä¸ªå…¨è¿æ¥å±‚å«åç½®ï¼›å®éªŒè¡¨æ˜ï¼Œ`SVD`åˆ†è§£å…¨è¿æ¥å±‚èƒ½ä½¿`mAP`åªä¸‹é™0.3%çš„æƒ…å†µä¸‹æå‡30%çš„é€Ÿåº¦ï¼ŒåŒæ—¶è¯¥æ–¹æ³•ä¹Ÿä¸å¿…å†æ‰§è¡Œé¢å¤–çš„å¾®è°ƒæ“ä½œã€‚

![](../../.gitbook/assets/image%20%2816%29.png)

> åœ¨GitHubçš„æºç ä¸­ï¼Œè¿™éƒ¨åˆ†ä¼¼ä¹æ²¡æœ‰å®ç°ã€‚

### ğŸ–‹ 3.4ã€è®­ç»ƒè¿‡ç¨‹



## ğŸ–Œ 4ã€Faster R-CNN

ç»è¿‡R-CNNå’Œ`Fast RCNN`çš„ç§¯æ·€ï¼Œ`Ross B. Girshick`åœ¨2016å¹´æå‡ºäº†æ–°çš„`Faster RCNN`ï¼Œåœ¨ç»“æ„ä¸Šï¼Œ`Faster RCNN`å·²ç»å°†ç‰¹å¾æŠ½å–ï¼Œproposalæå–ï¼Œbounding box regressionå’Œclassificationéƒ½æ•´åˆåœ¨äº†ä¸€ä¸ªç½‘ç»œä¸­ï¼Œä½¿å¾—ç»¼åˆæ€§èƒ½æœ‰è¾ƒå¤§æé«˜ï¼Œåœ¨æ£€æµ‹é€Ÿåº¦æ–¹é¢å°¤ä¸ºæ˜æ˜¾ã€‚

![Faster RCNN&#x57FA;&#x672C;&#x7ED3;&#x6784;&#xFF08;&#x6765;&#x81EA;&#x539F;&#x8BBA;&#x6587;&#xFF09;](../../.gitbook/assets/image%20%2817%29.png)

å¦‚å›¾ï¼ŒFaster RCNNå…¶å®å¯ä»¥åˆ†ä¸º4ä¸ªä¸»è¦å†…å®¹ï¼š

1. `Conv layers`ã€‚ä½œä¸ºä¸€ç§CNNç½‘ç»œç›®æ ‡æ£€æµ‹æ–¹æ³•ï¼ŒFaster RCNNé¦–å…ˆä½¿ç”¨ä¸€ç»„åŸºç¡€çš„`conv+relu+pooling`å±‚æå–imageçš„feature mapsã€‚è¯¥feature mapsè¢«å…±äº«ç”¨äºåç»­RPNå±‚å’Œå…¨è¿æ¥å±‚ã€‚
2. `Region Proposal Networks`ã€‚`RPN`ç½‘ç»œç”¨äºç”Ÿæˆregion proposalsã€‚è¯¥å±‚é€šè¿‡`softmax`åˆ¤æ–­anchorså±äºpositiveæˆ–è€…negativeï¼Œå†åˆ©ç”¨bounding box regressionä¿®æ­£anchorsè·å¾—ç²¾ç¡®çš„proposalsã€‚
3. `Roi Pooling`ã€‚è¯¥å±‚æ”¶é›†è¾“å…¥çš„feature mapså’Œproposalsï¼Œç»¼åˆè¿™äº›ä¿¡æ¯åæå–proposal feature mapsï¼Œé€å…¥åç»­å…¨è¿æ¥å±‚åˆ¤å®šç›®æ ‡ç±»åˆ«ã€‚
4. Classification and Bounding Box Regressionã€‚åˆ©ç”¨proposal feature mapsè®¡ç®—proposalçš„ç±»åˆ«ï¼ŒåŒæ—¶å†æ¬¡bounding box regressionè·å¾—æ£€æµ‹æ¡†æœ€ç»ˆçš„ç²¾ç¡®ä½ç½®ã€‚

### ğŸ–‹ 4.1ã€`Conv layers`

